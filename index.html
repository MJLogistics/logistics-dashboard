<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏïÑÏãúÏïÑÎ∞ú Í∏ÄÎ°úÎ≤å Î¨ºÎ•ò Ïö¥ÏûÑ ÎåÄÏãúÎ≥¥Îìú</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e0e0e0;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .update-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .update-time {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .data-status {
            background: #2ecc71;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        
        .google-sheets-section {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .sheets-config {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
        }
        
        .sheets-input {
            padding: 10px;
            border: 2px solid #fff;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .sheets-btn {
            padding: 10px 20px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .sheets-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .template-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .template-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            margin-top: 15px;
            overflow-x: auto;
            display: block;
        }
        
        .template-table th, .template-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            white-space: nowrap;
        }
        
        .template-table th {
            background: #34495e;
            color: white;
            font-weight: 600;
        }
        
        .template-table td {
            background: #f8f9fa;
        }
        
        .manual-input-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .input-field {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .route-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .route-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-top: 20px;
        }
        
        .route-group {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .route-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .save-btn {
            margin-top: 30px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-top: 4px solid;
        }
        
        .metric-card:nth-child(1) { border-top-color: #3498db; }
        .metric-card:nth-child(2) { border-top-color: #e74c3c; }
        .metric-card:nth-child(3) { border-top-color: #f39c12; }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .metric-title {
            font-size: 0.9em;
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .metric-change {
            font-size: 1em;
            padding: 5px 10px;
            border-radius: 12px;
            display: inline-block;
            font-weight: 600;
        }
        
        .positive {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }
        
        .negative {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .freight-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .freight-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        
        .freight-table th, .freight-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        
        .freight-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        .freight-table td {
            font-weight: 500;
        }
        
        .origin-header {
            background: #34495e !important;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        canvas {
            max-height: 400px;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .route-grid {
                grid-template-columns: 1fr;
            }
            
            .sheets-config {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üö¢ ‚úàÔ∏è ÏïÑÏãúÏïÑÎ∞ú Í∏ÄÎ°úÎ≤å Î¨ºÎ•ò Ïö¥ÏûÑ ÎåÄÏãúÎ≥¥Îìú</h1>
            <div class="update-info">
                <span class="update-time" id="updateTime">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: -</span>
                <span class="data-status">ÏÉÅÌï¥/ÌôçÏΩ© ‚Üí 4Í∞ú Í∂åÏó≠</span>
            </div>
        </div>

        <div class="google-sheets-section">
            <h3 style="margin-bottom: 15px;">üìä Google Sheets Ïó∞Îèô</h3>
            <div class="sheets-config">
                <input type="text" class="sheets-input" id="sheetsId" 
                       placeholder="Google Sheets ID ÏûÖÎ†• (URLÏùò /d/ Îã§Ïùå Î∂ÄÎ∂Ñ)" />
                <button class="sheets-btn" onclick="connectGoogleSheets()">üîó Ïó∞ÎèôÌïòÍ∏∞</button>
                <button class="sheets-btn" style="background: #27ae60;" onclick="autoUpdateFromSheets()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.9em; color: #2c3e50;">
                * Sheets Í≥µÏú† ÏÑ§Ï†ï: "ÎßÅÌÅ¨Í∞Ä ÏûàÎäî Î™®Îì† ÏÇ¨Ïö©Ïûê" ‚Üí "Î∑∞Ïñ¥"
            </p>
        </div>

        <div class="template-section">
            <h3 style="margin-bottom: 10px;">üìã Google Sheets ÌÖúÌîåÎ¶ø</h3>
            <p style="color: #7f8c8d; font-size: 0.9em; margin-bottom: 15px;">
                ÏïÑÎûò ÌòïÏãùÏúºÎ°ú Google SheetsÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî (Î™®Îì† Í∞íÏùÄ Ïà´ÏûêÎßå ÏûÖÎ†•)
            </p>
            <table class="template-table">
                <thead>
                    <tr>
                        <th rowspan="2">ÎÇ†Ïßú</th>
                        <th colspan="3">ÏßÄÏàò</th>
                        <th colspan="4">ÏÉÅÌï¥Î∞ú Ìï¥ÏÉÅÏö¥ÏûÑ (USD/TEU)</th>
                        <th colspan="4">ÏÉÅÌï¥Î∞ú Ìï≠Í≥µÏö¥ÏûÑ (USD/kg)</th>
                        <th colspan="4">ÌôçÏΩ©Î∞ú Ìï¥ÏÉÅÏö¥ÏûÑ (USD/TEU)</th>
                        <th colspan="4">ÌôçÏΩ©Î∞ú Ìï≠Í≥µÏö¥ÏûÑ (USD/kg)</th>
                    </tr>
                    <tr>
                        <th>BDI</th>
                        <th>SCFI</th>
                        <th>Harpex</th>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025-01-06</td>
                        <td>2008</td>
                        <td>2450</td>
                        <td>1520</td>
                        <td>3200</td>
                        <td>2800</td>
                        <td>2200</td>
                        <td>1800</td>
                        <td>4.8</td>
                        <td>3.5</td>
                        <td>3.2</td>
                        <td>2.8</td>
                        <td>3300</td>
                        <td>2900</td>
                        <td>2300</td>
                        <td>1900</td>
                        <td>5.0</td>
                        <td>3.7</td>
                        <td>3.4</td>
                        <td>3.0</td>
                    </tr>
                </tbody>
            </table>
            <button onclick="downloadTemplate()" style="margin-top: 15px; padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer;">
                üì• ÌÖúÌîåÎ¶ø Îã§Ïö¥Î°úÎìú (CSV)
            </button>
        </div>

        <div class="manual-input-section" id="manualInputSection">
            <h3 class="chart-title">üìù ÏàòÎèô Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•</h3>
            <p style="color: #7f8c8d; margin-bottom: 20px;">Google Sheets ÎØ∏Ïó∞Îèô Ïãú ÏßÅÏ†ë ÏûÖÎ†•</p>
            
            <div class="input-grid">
                <div class="input-group">
                    <label class="input-label">ÎÇ†Ïßú</label>
                    <input type="date" class="input-field" id="dataDate" />
                </div>
                <div class="input-group">
                    <label class="input-label">BDI</label>
                    <input type="number" class="input-field" id="bdiInput" placeholder="2008" />
                </div>
                <div class="input-group">
                    <label class="input-label">SCFI</label>
                    <input type="number" class="input-field" id="scfiInput" placeholder="2450" />
                </div>
                <div class="input-group">
                    <label class="input-label">Harpex</label>
                    <input type="number" class="input-field" id="harpexInput" placeholder="1520" />
                </div>
            </div>
            
            <div class="route-section">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">üåè Ìï≠Î°úÎ≥Ñ Ïã§Ï†ú Ïö¥ÏûÑ</h4>
                
                <div class="route-grid">
                    <div class="route-group">
                        <div class="route-title">üá®üá≥ ÏÉÅÌï¥ Ï∂úÎ∞ú</div>
                        
                        <h5 style="color: #7f8c8d; margin: 10px 0;">Ìï¥ÏÉÅ Ïö¥ÏûÑ (USD/TEU)</h5>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">‚Üí ÎØ∏ÏÑúÎ∂Ä</label>
                                <input type="number" class="input-field" id="sha-sea-us" placeholder="3200" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïú†ÎüΩ</label>
                                <input type="number" class="input-field" id="sha-sea-eu" placeholder="2800" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ï§ëÎèô</label>
                                <input type="number" class="input-field" id="sha-sea-me" placeholder="2200" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïù∏ÎèÑ</label>
                                <input type="number" class="input-field" id="sha-sea-in" placeholder="1800" />
                            </div>
                        </div>
                        
                        <h5 style="color: #7f8c8d; margin: 15px 0 10px;">Ìï≠Í≥µ Ïö¥ÏûÑ (USD/kg)</h5>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">‚Üí ÎØ∏ÏÑúÎ∂Ä</label>
                                <input type="number" step="0.1" class="input-field" id="sha-air-us" placeholder="4.8" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïú†ÎüΩ</label>
                                <input type="number" step="0.1" class="input-field" id="sha-air-eu" placeholder="3.5" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ï§ëÎèô</label>
                                <input type="number" step="0.1" class="input-field" id="sha-air-me" placeholder="3.2" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïù∏ÎèÑ</label>
                                <input type="number" step="0.1" class="input-field" id="sha-air-in" placeholder="2.8" />
                            </div>
                        </div>
                    </div>
                    
                    <div class="route-group">
                        <div class="route-title">üá≠üá∞ ÌôçÏΩ© Ï∂úÎ∞ú</div>
                        
                        <h5 style="color: #7f8c8d; margin: 10px 0;">Ìï¥ÏÉÅ Ïö¥ÏûÑ (USD/TEU)</h5>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">‚Üí ÎØ∏ÏÑúÎ∂Ä</label>
                                <input type="number" class="input-field" id="hkg-sea-us" placeholder="3300" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïú†ÎüΩ</label>
                                <input type="number" class="input-field" id="hkg-sea-eu" placeholder="2900" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ï§ëÎèô</label>
                                <input type="number" class="input-field" id="hkg-sea-me" placeholder="2300" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïù∏ÎèÑ</label>
                                <input type="number" class="input-field" id="hkg-sea-in" placeholder="1900" />
                            </div>
                        </div>
                        
                        <h5 style="color: #7f8c8d; margin: 15px 0 10px;">Ìï≠Í≥µ Ïö¥ÏûÑ (USD/kg)</h5>
                        <div class="input-grid">
                            <div class="input-group">
                                <label class="input-label">‚Üí ÎØ∏ÏÑúÎ∂Ä</label>
                                <input type="number" step="0.1" class="input-field" id="hkg-air-us" placeholder="5.0" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïú†ÎüΩ</label>
                                <input type="number" step="0.1" class="input-field" id="hkg-air-eu" placeholder="3.7" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ï§ëÎèô</label>
                                <input type="number" step="0.1" class="input-field" id="hkg-air-me" placeholder="3.4" />
                            </div>
                            <div class="input-group">
                                <label class="input-label">‚Üí Ïù∏ÎèÑ</label>
                                <input type="number" step="0.1" class="input-field" id="hkg-air-in" placeholder="3.0" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="save-btn" onclick="saveManualData()">üíæ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Î∞è ÎåÄÏãúÎ≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏</button>
        </div>

        <div class="metrics-grid" id="metricsGrid">
            <div class="loading">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
        </div>

        <div class="freight-table">
            <h3 class="chart-title">üìä ÌòÑÏû¨ Ïö¥ÏûÑ ÌòÑÌô©</h3>
            <table id="freightSummary">
                <thead>
                    <tr>
                        <th rowspan="2" class="origin-header">Ï∂úÎ∞úÏßÄ</th>
                        <th colspan="4">Ìï¥ÏÉÅ Ïö¥ÏûÑ (USD/TEU)</th>
                        <th colspan="4">Ìï≠Í≥µ Ïö¥ÏûÑ (USD/kg)</th>
                    </tr>
                    <tr>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                        <th>ÎØ∏ÏÑúÎ∂Ä</th>
                        <th>Ïú†ÎüΩ</th>
                        <th>Ï§ëÎèô</th>
                        <th>Ïù∏ÎèÑ</th>
                    </tr>
                </thead>
                <tbody id="freightSummaryBody">
                </tbody>
            </table>
        </div>

        <div class="chart-container full-width">
            <h3 class="chart-title">üìà Ï£ºÏöî ÏßÄÏàò Ìä∏Î†åÎìú</h3>
            <canvas id="indexTrendChart" height="100"></canvas>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">üö¢ Ìï¥ÏÉÅ Ïö¥ÏûÑ ÎπÑÍµê (ÏÉÅÌï¥Î∞ú)</h3>
                <canvas id="seaFreightChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">‚úàÔ∏è Ìï≠Í≥µ Ïö¥ÏûÑ ÎπÑÍµê (ÌôçÏΩ©Î∞ú)</h3>
                <canvas id="airFreightChart"></canvas>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">üìä Ï£ºÍ∞Ñ Î≥ÄÎèôÎ•†</h3>
                <canvas id="weeklyChangeChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">üåç Í∂åÏó≠Î≥Ñ Ïö¥ÏûÑ ÏßÄÏàò</h3>
                <canvas id="regionComparisonChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let data = {
            dates: [],
            indices: {
                BDI: [],
                SCFI: [],
                Harpex: []
            },
            freight: {
                shanghai: {
                    sea: { us: [], eu: [], me: [], in: [] },
                    air: { us: [], eu: [], me: [], in: [] }
                },
                hongkong: {
                    sea: { us: [], eu: [], me: [], in: [] },
                    air: { us: [], eu: [], me: [], in: [] }
                }
            }
        };
        
        let charts = {};
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        function loadStoredData() {
            const stored = localStorage.getItem('freightData');
            if (stored) {
                data = JSON.parse(stored);
                console.log('Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å');
            }
        }
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveToStorage() {
            localStorage.setItem('freightData', JSON.stringify(data));
            console.log('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å');
        }
        
        // Google Sheets Ïó∞Îèô
        async function connectGoogleSheets() {
            const sheetId = document.getElementById('sheetsId').value;
            if (!sheetId) {
                alert('Google Sheets IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            // Î¨¥Î£å Google Sheets API ÏÇ¨Ïö©
            const SHEET_RANGE = 'A:S'; // AÎ∂ÄÌÑ∞ SÍπåÏßÄ (19Í∞ú Ïª¨Îüº)
            const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${SHEET_RANGE}?key=AIzaSyBNlYH01_9Hc5S1J9vuFmu2nUqBZJNAXxs`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Sheets Ï†ëÍ∑º Ïã§Ìå®. Í≥µÏú† ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
                
                const result = await response.json();
                const rows = result.values;
                
                if (!rows || rows.length < 2) {
                    throw new Error('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÍ±∞ÎÇò ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
                
                // Îç∞Ïù¥ÌÑ∞ ÌååÏã±
                parseGoogleSheetsData(rows);
                
                // Ïó∞Îèô ÏÑ±Í≥µ
                localStorage.setItem('connectedSheetId', sheetId);
                alert(`‚úÖ Google Sheets Ïó∞Îèô ÏÑ±Í≥µ! ${rows.length - 1}Í∞ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú`);
                
                // ÏàòÎèô ÏûÖÎ†• ÏÑπÏÖò Ïà®Í∏∞Í∏∞
                document.getElementById('manualInputSection').style.display = 'none';
                
                // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                updateCharts();
                
            } catch (error) {
                console.error('Sheets Ïó∞Îèô Ïã§Ìå®:', error);
                alert(`‚ùå Ïó∞Îèô Ïã§Ìå®: ${error.message}`);
            }
        }
        
        // Google Sheets Îç∞Ïù¥ÌÑ∞ ÌååÏã±
        function parseGoogleSheetsData(rows) {
            // Ï¥àÍ∏∞Ìôî
            data.dates = [];
            Object.keys(data.indices).forEach(key => {
                data.indices[key] = [];
            });
            
            // Îç∞Ïù¥ÌÑ∞ Ìñâ Ï≤òÎ¶¨ (Ìó§Îçî Ï†úÏô∏)
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row || row.length === 0) continue;
                
                // ÎÇ†Ïßú
                const date = new Date(row[0]);
                if (isNaN(date.getTime())) continue;
                data.dates.push(date);
                
                // ÏßÄÏàò (BDI, SCFI, Harpex)
                data.indices.BDI.push(parseFloat(row[1]) || 0);
                data.indices.SCFI.push(parseFloat(row[2]) || 0);
                data.indices.Harpex.push(parseFloat(row[3]) || 0);
                
                // ÏÉÅÌï¥Î∞ú Ìï¥ÏÉÅ Ïö¥ÏûÑ
                data.freight.shanghai.sea.us.push(parseFloat(row[4]) || 0);
                data.freight.shanghai.sea.eu.push(parseFloat(row[5]) || 0);
                data.freight.shanghai.sea.me.push(parseFloat(row[6]) || 0);
                data.freight.shanghai.sea.in.push(parseFloat(row[7]) || 0);
                
                // ÏÉÅÌï¥Î∞ú Ìï≠Í≥µ Ïö¥ÏûÑ
                data.freight.shanghai.air.us.push(parseFloat(row[8]) || 0);
                data.freight.shanghai.air.eu.push(parseFloat(row[9]) || 0);
                data.freight.shanghai.air.me.push(parseFloat(row[10]) || 0);
                data.freight.shanghai.air.in.push(parseFloat(row[11]) || 0);
                
                // ÌôçÏΩ©Î∞ú Ìï¥ÏÉÅ Ïö¥ÏûÑ
                data.freight.hongkong.sea.us.push(parseFloat(row[12]) || 0);
                data.freight.hongkong.sea.eu.push(parseFloat(row[13]) || 0);
                data.freight.hongkong.sea.me.push(parseFloat(row[14]) || 0);
                data.freight.hongkong.sea.in.push(parseFloat(row[15]) || 0);
                
                // ÌôçÏΩ©Î∞ú Ìï≠Í≥µ Ïö¥ÏûÑ
                data.freight.hongkong.air.us.push(parseFloat(row[16]) || 0);
                data.freight.hongkong.air.eu.push(parseFloat(row[17]) || 0);
                data.freight.hongkong.air.me.push(parseFloat(row[18]) || 0);
                data.freight.hongkong.air.in.push(parseFloat(row[19]) || 0);
            }
            
            saveToStorage();
            console.log(`Google SheetsÏóêÏÑú ${data.dates.length}Í∞ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å`);
        }
        
        // ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
        async function autoUpdateFromSheets() {
            const sheetId = localStorage.getItem('connectedSheetId');
            if (!sheetId) {
                alert('Î®ºÏ†Ä Google SheetsÎ•º Ïó∞ÎèôÌï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            document.getElementById('sheetsId').value = sheetId;
            await connectGoogleSheets();
            
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                `ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${now.toLocaleString('ko-KR')}`;
        }
        
        // ÏàòÎèô Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveManualData() {
            const date = document.getElementById('dataDate').value;
            if (!date) {
                alert('ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            // ÏÉà Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
            data.dates.push(new Date(date));
            
            // ÏßÄÏàò Îç∞Ïù¥ÌÑ∞
            data.indices.BDI.push(parseFloat(document.getElementById('bdiInput').value) || 0);
            data.indices.SCFI.push(parseFloat(document.getElementById('scfiInput').value) || 0);
            data.indices.Harpex.push(parseFloat(document.getElementById('harpexInput').value) || 0);
            
            // ÏÉÅÌï¥Î∞ú Ïö¥ÏûÑ
            data.freight.shanghai.sea.us.push(parseFloat(document.getElementById('sha-sea-us').value) || 0);
            data.freight.shanghai.sea.eu.push(parseFloat(document.getElementById('sha-sea-eu').value) || 0);
            data.freight.shanghai.sea.me.push(parseFloat(document.getElementById('sha-sea-me').value) || 0);
            data.freight.shanghai.sea.in.push(parseFloat(document.getElementById('sha-sea-in').value) || 0);
            
            data.freight.shanghai.air.us.push(parseFloat(document.getElementById('sha-air-us').value) || 0);
            data.freight.shanghai.air.eu.push(parseFloat(document.getElementById('sha-air-eu').value) || 0);
            data.freight.shanghai.air.me.push(parseFloat(document.getElementById('sha-air-me').value) || 0);
            data.freight.shanghai.air.in.push(parseFloat(document.getElementById('sha-air-in').value) || 0);
            
            // ÌôçÏΩ©Î∞ú Ïö¥ÏûÑ
            data.freight.hongkong.sea.us.push(parseFloat(document.getElementById('hkg-sea-us').value) || 0);
            data.freight.hongkong.sea.eu.push(parseFloat(document.getElementById('hkg-sea-eu').value) || 0);
            data.freight.hongkong.sea.me.push(parseFloat(document.getElementById('hkg-sea-me').value) || 0);
            data.freight.hongkong.sea.in.push(parseFloat(document.getElementById('hkg-sea-in').value) || 0);
            
            data.freight.hongkong.air.us.push(parseFloat(document.getElementById('hkg-air-us').value) || 0);
            data.freight.hongkong.air.eu.push(parseFloat(document.getElementById('hkg-air-eu').value) || 0);
            data.freight.hongkong.air.me.push(parseFloat(document.getElementById('hkg-air-me').value) || 0);
            data.freight.hongkong.air.in.push(parseFloat(document.getElementById('hkg-air-in').value) || 0);
            
            // Ï†ÄÏû• Î∞è ÏóÖÎç∞Ïù¥Ìä∏
            saveToStorage();
            updateCharts();
            
            alert('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
            
            // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.input-field').forEach(field => {
                if (field.type !== 'date') field.value = '';
            });
        }
        
        // ÌÖúÌîåÎ¶ø Îã§Ïö¥Î°úÎìú
        function downloadTemplate() {
            // BOM Ï∂îÍ∞ÄÎ°ú ÌïúÍ∏Ä ÏóëÏÖÄ Ìò∏ÌôòÏÑ± Í∞úÏÑ†
            const BOM = '\uFEFF';
            const csvContent = BOM + `ÎÇ†Ïßú,BDI,SCFI,Harpex,SHA-Sea-US,SHA-Sea-EU,SHA-Sea-ME,SHA-Sea-IN,SHA-Air-US,SHA-Air-EU,SHA-Air-ME,SHA-Air-IN,HKG-Sea-US,HKG-Sea-EU,HKG-Sea-ME,HKG-Sea-IN,HKG-Air-US,HKG-Air-EU,HKG-Air-ME,HKG-Air-IN
2025-01-06,2008,2450,1520,3200,2800,2200,1800,4.8,3.5,3.2,2.8,3300,2900,2300,1900,5.0,3.7,3.4,3.0
2025-01-13,2050,2480,1550,3250,2850,2250,1850,4.9,3.6,3.3,2.9,3350,2950,2350,1950,5.1,3.8,3.5,3.1
2025-01-20,2100,2500,1580,3300,2900,2300,1900,5.0,3.7,3.4,3.0,3400,3000,2400,2000,5.2,3.9,3.6,3.2`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'logistics_freight_template.csv');
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // URL Í∞ùÏ≤¥ Ï†ïÎ¶¨
            window.URL.revokeObjectURL(url);
        }
        
        // Î©îÌä∏Î¶≠ Ïπ¥Îìú ÏÉùÏÑ±
        function createMetricCards() {
            const metricsGrid = document.getElementById('metricsGrid');
            
            if (data.dates.length === 0) {
                metricsGrid.innerHTML = '<div class="loading">Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>';
                return;
            }
            
            const latest = {
                BDI: data.indices.BDI[data.indices.BDI.length - 1],
                SCFI: data.indices.SCFI[data.indices.SCFI.length - 1],
                Harpex: data.indices.Harpex[data.indices.Harpex.length - 1]
            };
            
            const changes = {
                BDI: calculateChange(data.indices.BDI),
                SCFI: calculateChange(data.indices.SCFI),
                Harpex: calculateChange(data.indices.Harpex)
            };
            
            metricsGrid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-title">Î∞úÌã±Ïö¥ÏûÑÏßÄÏàò</div>
                    <div class="metric-value">${latest.BDI.toFixed(0)}</div>
                    <span class="metric-change ${changes.BDI >= 0 ? 'positive' : 'negative'}">
                        ${changes.BDI >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(changes.BDI).toFixed(2)}%
                    </span>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ÏÉÅÌï¥Ïª®ÌÖåÏù¥ÎÑàÏö¥ÏûÑÏßÄÏàò</div>
                    <div class="metric-value">${latest.SCFI.toFixed(0)}</div>
                    <span class="metric-change ${changes.SCFI >= 0 ? 'positive' : 'negative'}">
                        ${changes.SCFI >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(changes.SCFI).toFixed(2)}%
                    </span>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ÌïòÌéôÏä§ ÏßÄÏàò</div>
                    <div class="metric-value">${latest.Harpex.toFixed(0)}</div>
                    <span class="metric-change ${changes.Harpex >= 0 ? 'positive' : 'negative'}">
                        ${changes.Harpex >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(changes.Harpex).toFixed(2)}%
                    </span>
                </div>
            `;
        }
        
        // Ïö¥ÏûÑ ÏöîÏïΩ ÌÖåÏù¥Î∏î ÏÉùÏÑ±
        function createFreightSummary() {
            const tbody = document.getElementById('freightSummaryBody');
            
            if (data.dates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9">Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</td></tr>';
                return;
            }
            
            const latest = {
                shanghai: {
                    sea: {
                        us: data.freight.shanghai.sea.us[data.freight.shanghai.sea.us.length - 1],
                        eu: data.freight.shanghai.sea.eu[data.freight.shanghai.sea.eu.length - 1],
                        me: data.freight.shanghai.sea.me[data.freight.shanghai.sea.me.length - 1],
                        in: data.freight.shanghai.sea.in[data.freight.shanghai.sea.in.length - 1]
                    },
                    air: {
                        us: data.freight.shanghai.air.us[data.freight.shanghai.air.us.length - 1],
                        eu: data.freight.shanghai.air.eu[data.freight.shanghai.air.eu.length - 1],
                        me: data.freight.shanghai.air.me[data.freight.shanghai.air.me.length - 1],
                        in: data.freight.shanghai.air.in[data.freight.shanghai.air.in.length - 1]
                    }
                },
                hongkong: {
                    sea: {
                        us: data.freight.hongkong.sea.us[data.freight.hongkong.sea.us.length - 1],
                        eu: data.freight.hongkong.sea.eu[data.freight.hongkong.sea.eu.length - 1],
                        me: data.freight.hongkong.sea.me[data.freight.hongkong.sea.me.length - 1],
                        in: data.freight.hongkong.sea.in[data.freight.hongkong.sea.in.length - 1]
                    },
                    air: {
                        us: data.freight.hongkong.air.us[data.freight.hongkong.air.us.length - 1],
                        eu: data.freight.hongkong.air.eu[data.freight.hongkong.air.eu.length - 1],
                        me: data.freight.hongkong.air.me[data.freight.hongkong.air.me.length - 1],
                        in: data.freight.hongkong.air.in[data.freight.hongkong.air.in.length - 1]
                    }
                }
            };
            
            tbody.innerHTML = `
                <tr>
                    <td style="font-weight: bold;">üá®üá≥ ÏÉÅÌï¥</td>
                    <td>$${latest.shanghai.sea.us.toFixed(0)}</td>
                    <td>$${latest.shanghai.sea.eu.toFixed(0)}</td>
                    <td>$${latest.shanghai.sea.me.toFixed(0)}</td>
                    <td>$${latest.shanghai.sea.in.toFixed(0)}</td>
                    <td>$${latest.shanghai.air.us.toFixed(1)}</td>
                    <td>$${latest.shanghai.air.eu.toFixed(1)}</td>
                    <td>$${latest.shanghai.air.me.toFixed(1)}</td>
                    <td>$${latest.shanghai.air.in.toFixed(1)}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">üá≠üá∞ ÌôçÏΩ©</td>
                    <td>$${latest.hongkong.sea.us.toFixed(0)}</td>
                    <td>$${latest.hongkong.sea.eu.toFixed(0)}</td>
                    <td>$${latest.hongkong.sea.me.toFixed(0)}</td>
                    <td>$${latest.hongkong.sea.in.toFixed(0)}</td>
                    <td>$${latest.hongkong.air.us.toFixed(1)}</td>
                    <td>$${latest.hongkong.air.eu.toFixed(1)}</td>
                    <td>$${latest.hongkong.air.me.toFixed(1)}</td>
                    <td>$${latest.hongkong.air.in.toFixed(1)}</td>
                </tr>
            `;
        }
        
        // Î≥ÄÌôîÏú® Í≥ÑÏÇ∞
        function calculateChange(values) {
            if (values.length < 2) return 0;
            const current = values[values.length - 1];
            const previous = values[Math.max(0, values.length - 8)];
            return ((current - previous) / previous * 100);
        }
        
        // ÏßÄÏàò Ìä∏Î†åÎìú Ï∞®Ìä∏
        function createIndexTrendChart() {
            const ctx = document.getElementById('indexTrendChart').getContext('2d');
            
            if (charts.indexTrend) {
                charts.indexTrend.destroy();
            }
            
            charts.indexTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'BDI',
                            data: normalizeData(data.indices.BDI),
                            borderColor: '#3498db',
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'SCFI',
                            data: normalizeData(data.indices.SCFI),
                            borderColor: '#e74c3c',
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'Harpex',
                            data: normalizeData(data.indices.Harpex),
                            borderColor: '#f39c12',
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Ï†ïÍ∑úÌôî Í∞í (100 = Í∏∞Ï§Ä)'
                            }
                        }
                    }
                }
            });
        }
        
        // Ìï¥ÏÉÅ Ïö¥ÏûÑ Ï∞®Ìä∏
        function createSeaFreightChart() {
            const ctx = document.getElementById('seaFreightChart').getContext('2d');
            
            if (charts.seaFreight) {
                charts.seaFreight.destroy();
            }
            
            charts.seaFreight = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'ÎØ∏ÏÑúÎ∂Ä',
                            data: data.freight.shanghai.sea.us,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ïú†ÎüΩ',
                            data: data.freight.shanghai.sea.eu,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ï§ëÎèô',
                            data: data.freight.shanghai.sea.me,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ïù∏ÎèÑ',
                            data: data.freight.shanghai.sea.in,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'USD/TEU'
                            }
                        }
                    }
                }
            });
        }
        
        // Ìï≠Í≥µ Ïö¥ÏûÑ Ï∞®Ìä∏
        function createAirFreightChart() {
            const ctx = document.getElementById('airFreightChart').getContext('2d');
            
            if (charts.airFreight) {
                charts.airFreight.destroy();
            }
            
            charts.airFreight = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'ÎØ∏ÏÑúÎ∂Ä',
                            data: data.freight.hongkong.air.us,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ïú†ÎüΩ',
                            data: data.freight.hongkong.air.eu,
                            borderColor: '#1abc9c',
                            backgroundColor: 'rgba(26, 188, 156, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ï§ëÎèô',
                            data: data.freight.hongkong.air.me,
                            borderColor: '#34495e',
                            backgroundColor: 'rgba(52, 73, 94, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Ïù∏ÎèÑ',
                            data: data.freight.hongkong.air.in,
                            borderColor: '#e67e22',
                            backgroundColor: 'rgba(230, 126, 34, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'USD/kg'
                            }
                        }
                    }
                }
            });
        }
        
        // Ï£ºÍ∞Ñ Î≥ÄÎèôÎ•† Ï∞®Ìä∏
        function createWeeklyChangeChart() {
            const ctx = document.getElementById('weeklyChangeChart').getContext('2d');
            
            if (charts.weeklyChange) {
                charts.weeklyChange.destroy();
            }
            
            const changes = [
                { label: 'BDI', value: calculateChange(data.indices.BDI) },
                { label: 'SCFI', value: calculateChange(data.indices.SCFI) },
                { label: 'Harpex', value: calculateChange(data.indices.Harpex) }
            ];
            
            charts.weeklyChange = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: changes.map(c => c.label),
                    datasets: [{
                        label: 'Ï£ºÍ∞Ñ Î≥ÄÎèôÎ•† (%)',
                        data: changes.map(c => c.value),
                        backgroundColor: changes.map(c => 
                            c.value >= 0 ? 'rgba(46, 204, 113, 0.6)' : 'rgba(231, 76, 60, 0.6)'
                        ),
                        borderColor: changes.map(c => 
                            c.value >= 0 ? '#2ecc71' : '#e74c3c'
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Î≥ÄÎèôÎ•† (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // Í∂åÏó≠Î≥Ñ ÎπÑÍµê Ï∞®Ìä∏
        function createRegionComparisonChart() {
            const ctx = document.getElementById('regionComparisonChart').getContext('2d');
            
            if (charts.regionComparison) {
                charts.regionComparison.destroy();
            }
            
            if (data.dates.length === 0) return;
            
            const latest = {
                us: (data.freight.shanghai.sea.us[data.freight.shanghai.sea.us.length - 1] + 
                     data.freight.hongkong.sea.us[data.freight.hongkong.sea.us.length - 1]) / 2,
                eu: (data.freight.shanghai.sea.eu[data.freight.shanghai.sea.eu.length - 1] + 
                     data.freight.hongkong.sea.eu[data.freight.hongkong.sea.eu.length - 1]) / 2,
                me: (data.freight.shanghai.sea.me[data.freight.shanghai.sea.me.length - 1] + 
                     data.freight.hongkong.sea.me[data.freight.hongkong.sea.me.length - 1]) / 2,
                in: (data.freight.shanghai.sea.in[data.freight.shanghai.sea.in.length - 1] + 
                     data.freight.hongkong.sea.in[data.freight.hongkong.sea.in.length - 1]) / 2
            };
            
            charts.regionComparison = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ÎØ∏ÏÑúÎ∂Ä', 'Ïú†ÎüΩ', 'Ï§ëÎèô', 'Ïù∏ÎèÑ'],
                    datasets: [{
                        label: 'ÌèâÍ∑† Ìï¥ÏÉÅ Ïö¥ÏûÑ (USD/TEU)',
                        data: [latest.us, latest.eu, latest.me, latest.in],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Îç∞Ïù¥ÌÑ∞ Ï†ïÍ∑úÌôî
        function normalizeData(values) {
            if (!values || values.length === 0) return [];
            const base = values[0];
            if (base === 0) return values;
            return values.map(v => (v / base) * 100);
        }
        
        // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCharts() {
            createMetricCards();
            createFreightSummary();
            
            if (data.dates.length > 0) {
                createIndexTrendChart();
                createSeaFreightChart();
                createAirFreightChart();
                createWeeklyChangeChart();
                createRegionComparisonChart();
            }
            
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                `ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${now.toLocaleString('ko-KR')}`;
        }
        
        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (Îç∞Î™®Ïö©)
        function generateInitialData() {
            const today = new Date();
            const dates = [];
            
            // 4Ï£ºÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            for (let i = 3; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - (i * 7));
                dates.push(date);
            }
            
            data = {
                dates: dates,
                indices: {
                    BDI: [2008, 2050, 2100, 2080],
                    SCFI: [2450, 2480, 2500, 2520],
                    Harpex: [1520, 1550, 1580, 1560]
                },
                freight: {
                    shanghai: {
                        sea: {
                            us: [3200, 3250, 3300, 3280],
                            eu: [2800, 2850, 2900, 2880],
                            me: [2200, 2250, 2300, 2280],
                            in: [1800, 1850, 1900, 1880]
                        },
                        air: {
                            us: [4.8, 4.9, 5.0, 4.95],
                            eu: [3.5, 3.6, 3.7, 3.65],
                            me: [3.2, 3.3, 3.4, 3.35],
                            in: [2.8, 2.9, 3.0, 2.95]
                        }
                    },
                    hongkong: {
                        sea: {
                            us: [3300, 3350, 3400, 3380],
                            eu: [2900, 2950, 3000, 2980],
                            me: [2300, 2350, 2400, 2380],
                            in: [1900, 1950, 2000, 1980]
                        },
                        air: {
                            us: [5.0, 5.1, 5.2, 5.15],
                            eu: [3.7, 3.8, 3.9, 3.85],
                            me: [3.4, 3.5, 3.6, 3.55],
                            in: [3.0, 3.1, 3.2, 3.15]
                        }
                    }
                }
            };
        }
        
        // Ï¥àÍ∏∞Ìôî
        window.addEventListener('DOMContentLoaded', function() {
            // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
            document.getElementById('dataDate').value = new Date().toISOString().split('T')[0];
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            loadStoredData();
            
            // Ï†ÄÏû•Îêú Sheet IDÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèô Ïó∞Îèô
            const savedSheetId = localStorage.getItem('connectedSheetId');
            if (savedSheetId) {
                document.getElementById('sheetsId').value = savedSheetId;
                autoUpdateFromSheets();
            } else {
                // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                if (data.dates.length === 0) {
                    generateInitialData();
                }
                updateCharts();
            }
        });
    </script>
</body>
</html>