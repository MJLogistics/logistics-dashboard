<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJL ì•„ì‹œì•„ë°œ ê¸€ë¡œë²Œ ë¬¼ë¥˜ ìš´ì„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e0e0e0;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .update-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .update-time {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .data-status {
            background: #e74c3c;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        
        .control-panel {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-section {
            margin-bottom: 20px;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        .control-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .upload-area {
            border: 2px dashed #e74c3c;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .upload-area:hover {
            border-color: #c0392b;
            background: #fdf2f2;
        }
        
        .upload-area.dragover {
            border-color: #27ae60;
            background: #f1f9f1;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-text {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-size: 0.9em;
            color: #2c3e50;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .filter-input {
            padding: 10px;
            border: 2px solid #fff;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            background: #c0392b;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-top: 4px solid;
        }
        
        .metric-card:nth-child(1) { border-top-color: #3498db; }
        .metric-card:nth-child(2) { border-top-color: #e74c3c; }
        .metric-card:nth-child(3) { border-top-color: #f39c12; }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .metric-title {
            font-size: 0.9em;
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .metric-change {
            font-size: 1em;
            padding: 5px 10px;
            border-radius: 12px;
            display: inline-block;
            font-weight: 600;
        }
        
        .positive {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }
        
        .negative {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .freight-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .freight-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        
        .freight-table th, .freight-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        
        .freight-table th {
            background: #e74c3c;
            color: white;
            font-weight: 600;
        }
        
        .freight-table td {
            font-weight: 500;
        }
        
        .origin-header {
            background: #34495e !important;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        .no-data {
            text-align: center;
            padding: 50px;
            font-size: 1.1em;
            color: #e74c3c;
            background: #fdf2f2;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .chart-canvas {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .chart-canvas canvas {
            max-height: 400px !important;
        }
        
        .download-btn {
            background: #2ecc71;
            margin-top: 15px;
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .download-btn:hover {
            background: #229954;
        }
        
        .file-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #27ae60;
        }
        
        .demo-notice {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>ğŸš¢ âœˆï¸ MJL ì•„ì‹œì•„ë°œ ê¸€ë¡œë²Œ ë¬¼ë¥˜ ìš´ì„ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="subtitle">MJ LOGISTICS GLOBAL FREIGHT RATE DASHBOARD</div>
            <div class="update-info">
                <span class="update-time" id="updateTime">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
                <span class="data-status">ì•„ì‹œì•„ â†’ ë¶ë¯¸/ìœ ëŸ½/ë™ë‚¨ì•„</span>
            </div>
        </div>

        <div class="demo-notice">
            ğŸ“Š í˜„ì¬ ë°ëª¨ ë°ì´í„°ë¡œ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤. Excel/CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.
        </div>

        <div class="control-panel">
            <div class="control-section">
                <div class="control-title">ğŸ“‚ Excel/CSV íŒŒì¼ ì—…ë¡œë“œ</div>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-text">ğŸ“¥ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</div>
                    <div class="upload-hint">Excel (.xlsx) ë˜ëŠ” CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" />
                <div id="fileInfo" class="file-info" style="display: none;"></div>
            </div>
            
            <div class="control-section">
                <div class="control-title">ğŸ“… ë°ì´í„° í•„í„°ë§</div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label">ì‹œì‘ ë‚ ì§œ</label>
                        <input type="date" class="filter-input" id="startDate" />
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ì¢…ë£Œ ë‚ ì§œ</label>
                        <input type="date" class="filter-input" id="endDate" />
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ì›”ë³„ í•„í„°</label>
                        <select class="filter-input" id="monthFilter">
                            <option value="">ì „ì²´ ì›”</option>
                            <option value="1">1ì›”</option>
                            <option value="2">2ì›”</option>
                            <option value="3">3ì›”</option>
                            <option value="4">4ì›”</option>
                            <option value="5">5ì›”</option>
                            <option value="6">6ì›”</option>
                            <option value="7">7ì›”</option>
                            <option value="8">8ì›”</option>
                            <option value="9">9ì›”</option>
                            <option value="10">10ì›”</option>
                            <option value="11">11ì›”</option>
                            <option value="12">12ì›”</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ì—°ë„ í•„í„°</label>
                        <select class="filter-input" id="yearFilter">
                            <option value="">ì „ì²´ ì—°ë„</option>
                            <option value="2025">2025ë…„</option>
                            <option value="2024">2024ë…„</option>
                            <option value="2023">2023ë…„</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="filter-btn" onclick="applyFilters()">ğŸ” í•„í„° ì ìš©</button>
                    </div>
                    <div class="filter-group">
                        <button class="filter-btn" onclick="resetFilters()" style="background: #95a5a6;">ğŸ”„ ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="metrics-grid" id="metricsGrid">
            <!-- ë©”íŠ¸ë¦­ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <div class="freight-table">
            <h3 class="chart-title">ğŸ“Š í˜„ì¬ ìš´ì„ í˜„í™© (MJL ì£¼ìš” ë…¸ì„ )</h3>
            <table id="freightSummary">
                <thead>
                    <tr>
                        <th rowspan="2" class="origin-header">ì¶œë°œì§€</th>
                        <th colspan="4">í•´ìƒ ìš´ì„ (USD/TEU)</th>
                        <th colspan="4">í•­ê³µ ìš´ì„ (USD/kg)</th>
                    </tr>
                    <tr>
                        <th>ë¶ë¯¸ì„œë¶€</th>
                        <th>ìœ ëŸ½</th>
                        <th>ë™ë‚¨ì•„</th>
                        <th>ì¸ë„</th>
                        <th>ë¶ë¯¸ì„œë¶€</th>
                        <th>ìœ ëŸ½</th>
                        <th>ë™ë‚¨ì•„</th>
                        <th>ì¸ë„</th>
                    </tr>
                </thead>
                <tbody id="freightSummaryBody">
                    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>

        <div class="chart-container full-width">
            <h3 class="chart-title">ğŸ“ˆ ë¬¼ë¥˜ ì§€ìˆ˜ íŠ¸ë Œë“œ (BDI, SCFI, Harpex)</h3>
            <div class="chart-canvas">
                <canvas id="indexTrendChart"></canvas>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">ğŸš¢ ìƒí•´ë°œ í•´ìƒ ìš´ì„ ì¶”ì´</h3>
                <div class="chart-canvas">
                    <canvas id="seaFreightChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">âœˆï¸ í™ì½©ë°œ í•­ê³µ ìš´ì„ ì¶”ì´</h3>
                <div class="chart-canvas">
                    <canvas id="airFreightChart"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">ğŸ“Š ì£¼ê°„ ì§€ìˆ˜ ë³€ë™ë¥ </h3>
                <div class="chart-canvas">
                    <canvas id="weeklyChangeChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">ğŸŒ ê¶Œì—­ë³„ í‰ê·  ìš´ì„ ë¹„êµ</h3>
                <div class="chart-canvas">
                    <canvas id="regionComparisonChart"></canvas>
                </div>
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“‹ íŒŒì¼ í˜•ì‹ ê°€ì´ë“œ</h3>
            <p style="color: #7f8c8d; margin-bottom: 10px;">Excel ë˜ëŠ” CSV íŒŒì¼ì— ë‹¤ìŒ ìˆœì„œë¡œ ì»¬ëŸ¼ì„ ì‘ì„±í•˜ì„¸ìš”:</p>
            <p style="font-size: 0.9em; color: #2c3e50; line-height: 1.6;">
                ë‚ ì§œ, BDI, SCFI, Harpex, 
                ìƒí•´-í•´ìƒ-ë¶ë¯¸ì„œë¶€, ìƒí•´-í•´ìƒ-ìœ ëŸ½, ìƒí•´-í•´ìƒ-ë™ë‚¨ì•„, ìƒí•´-í•´ìƒ-ì¸ë„,
                ìƒí•´-í•­ê³µ-ë¶ë¯¸ì„œë¶€, ìƒí•´-í•­ê³µ-ìœ ëŸ½, ìƒí•´-í•­ê³µ-ë™ë‚¨ì•„, ìƒí•´-í•­ê³µ-ì¸ë„,
                í™ì½©-í•´ìƒ-ë¶ë¯¸ì„œë¶€, í™ì½©-í•´ìƒ-ìœ ëŸ½, í™ì½©-í•´ìƒ-ë™ë‚¨ì•„, í™ì½©-í•´ìƒ-ì¸ë„,
                í™ì½©-í•­ê³µ-ë¶ë¯¸ì„œë¶€, í™ì½©-í•­ê³µ-ìœ ëŸ½, í™ì½©-í•­ê³µ-ë™ë‚¨ì•„, í™ì½©-í•­ê³µ-ì¸ë„
            </p>
            <button class="download-btn" onclick="downloadTemplate()">ğŸ“¥ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let rawData = {
            dates: [],
            indices: { BDI: [], SCFI: [], Harpex: [] },
            freight: {
                shanghai: {
                    sea: { us: [], eu: [], sea: [], in: [] },
                    air: { us: [], eu: [], sea: [], in: [] }
                },
                hongkong: {
                    sea: { us: [], eu: [], sea: [], in: [] },
                    air: { us: [], eu: [], sea: [], in: [] }
                }
            }
        };
        
        let filteredData = {};
        let chartInstances = {};
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            initializeApp();
        });
        
        function initializeApp() {
            setupFileUpload();
            generateDemoData();
            setDefaultFilters();
            updateCharts();
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.onclick = () => fileInput.click();
            fileInput.onchange = (e) => {
                if (e.target.files.length > 0) {
                    processFile(e.target.files[0]);
                }
            };
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            uploadArea.ondragover = (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            };
            
            uploadArea.ondragleave = () => {
                uploadArea.classList.remove('dragover');
            };
            
            uploadArea.ondrop = (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    processFile(e.dataTransfer.files[0]);
                }
            };
        }
        
        // íŒŒì¼ ì²˜ë¦¬
        function processFile(file) {
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.style.display = 'block';
            fileInfo.innerHTML = `ğŸ“„ ì²˜ë¦¬ ì¤‘: ${file.name}`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        parseCSVData(e.target.result);
                    } else {
                        parseExcelData(e.target.result);
                    }
                    fileInfo.innerHTML = `âœ… ì„±ê³µ: ${file.name} - ${rawData.dates.length}ê°œ ë°ì´í„°`;
                    setDefaultFilters();
                    applyFilters();
                } catch (error) {
                    console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    fileInfo.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                    fileInfo.style.background = '#fdf2f2';
                    fileInfo.style.color = '#e74c3c';
                }
            };
            
            if (file.name.toLowerCase().endsWith('.csv')) {
                reader.readAsText(file, 'UTF-8');
            } else {
                reader.readAsArrayBuffer(file);
            }
        }
        
        // CSV íŒŒì‹±
        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            resetData();
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = line.split(',');
                if (values.length < 20) continue;
                
                const date = new Date(values[0]);
                if (isNaN(date.getTime())) continue;
                
                addDataRow(values, date);
            }
        }
        
        // Excel íŒŒì‹±
        function parseExcelData(arrayBuffer) {
            const workbook = XLSX.read(arrayBuffer);
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            resetData();
            
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length < 20) continue;
                
                const date = new Date(row[0]);
                if (isNaN(date.getTime())) continue;
                
                addDataRow(row, date);
            }
        }
        
        // ë°ì´í„° í–‰ ì¶”ê°€
        function addDataRow(values, date) {
            rawData.dates.push(date);
            rawData.indices.BDI.push(parseFloat(values[1]) || 0);
            rawData.indices.SCFI.push(parseFloat(values[2]) || 0);
            rawData.indices.Harpex.push(parseFloat(values[3]) || 0);
            
            // ìƒí•´ ìš´ì„
            rawData.freight.shanghai.sea.us.push(parseFloat(values[4]) || 0);
            rawData.freight.shanghai.sea.eu.push(parseFloat(values[5]) || 0);
            rawData.freight.shanghai.sea.sea.push(parseFloat(values[6]) || 0);
            rawData.freight.shanghai.sea.in.push(parseFloat(values[7]) || 0);
            
            rawData.freight.shanghai.air.us.push(parseFloat(values[8]) || 0);
            rawData.freight.shanghai.air.eu.push(parseFloat(values[9]) || 0);
            rawData.freight.shanghai.air.sea.push(parseFloat(values[10]) || 0);
            rawData.freight.shanghai.air.in.push(parseFloat(values[11]) || 0);
            
            // í™ì½© ìš´ì„
            rawData.freight.hongkong.sea.us.push(parseFloat(values[12]) || 0);
            rawData.freight.hongkong.sea.eu.push(parseFloat(values[13]) || 0);
            rawData.freight.hongkong.sea.sea.push(parseFloat(values[14]) || 0);
            rawData.freight.hongkong.sea.in.push(parseFloat(values[15]) || 0);
            
            rawData.freight.hongkong.air.us.push(parseFloat(values[16]) || 0);
            rawData.freight.hongkong.air.eu.push(parseFloat(values[17]) || 0);
            rawData.freight.hongkong.air.sea.push(parseFloat(values[18]) || 0);
            rawData.freight.hongkong.air.in.push(parseFloat(values[19]) || 0);
        }
        
        // ë°ì´í„° ì´ˆê¸°í™”
        function resetData() {
            rawData.dates = [];
            Object.keys(rawData.indices).forEach(key => rawData.indices[key] = []);
            ['shanghai', 'hongkong'].forEach(city => {
                ['sea', 'air'].forEach(mode => {
                    ['us', 'eu', 'sea', 'in'].forEach(dest => {
                        rawData.freight[city][mode][dest] = [];
                    });
                });
            });
        }
        
        // ë°ëª¨ ë°ì´í„° ìƒì„±
        function generateDemoData() {
            const today = new Date();
            const dates = [];
            
            for (let i = 11; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - (i * 7));
                dates.push(date);
            }
            
            rawData.dates = dates;
            rawData.indices = {
                BDI: [1950, 2008, 2050, 2100, 2080, 2120, 2090, 2150, 2180, 2200, 2170, 2220],
                SCFI: [2350, 2450, 2480, 2500, 2520, 2490, 2530, 2550, 2580, 2600, 2570, 2620],
                Harpex: [1450, 1520, 1550, 1580, 1560, 1590, 1570, 1610, 1630, 1650, 1640, 1670]
            };
            
            rawData.freight = {
                shanghai: {
                    sea: {
                        us: [3100, 3200, 3250, 3300, 3280, 3320, 3290, 3350, 3380, 3400, 3370, 3420],
                        eu: [2700, 2800, 2850, 2900, 2880, 2920, 2890, 2950, 2980, 3000, 2970, 3020],
                        sea: [1100, 1200, 1250, 1300, 1280, 1320, 1290, 1350, 1380, 1400, 1370, 1420],
                        in: [1700, 1800, 1850, 1900, 1880, 1920, 1890, 1950, 1980, 2000, 1970, 2020]
                    },
                    air: {
                        us: [4.6, 4.8, 4.9, 5.0, 4.95, 5.1, 5.0, 5.2, 5.3, 5.4, 5.25, 5.5],
                        eu: [3.3, 3.5, 3.6, 3.7, 3.65, 3.8, 3.7, 3.9, 4.0, 4.1, 3.95, 4.2],
                        sea: [1.9, 2.1, 2.2, 2.3, 2.25, 2.4, 2.3, 2.5, 2.6, 2.7, 2.55, 2.8],
                        in: [2.6, 2.8, 2.9, 3.0, 2.95, 3.1, 3.0, 3.2, 3.3, 3.4, 3.25, 3.5]
                    }
                },
                hongkong: {
                    sea: {
                        us: [3200, 3300, 3350, 3400, 3380, 3420, 3390, 3450, 3480, 3500, 3470, 3520],
                        eu: [2800, 2900, 2950, 3000, 2980, 3020, 2990, 3050, 3080, 3100, 3070, 3120],
                        sea: [1200, 1300, 1350, 1400, 1380, 1420, 1390, 1450, 1480, 1500, 1470, 1520],
                        in: [1800, 1900, 1950, 2000, 1980, 2020, 1990, 2050, 2080, 2100, 2070, 2120]
                    },
                    air: {
                        us: [4.8, 5.0, 5.1, 5.2, 5.15, 5.3, 5.2, 5.4, 5.5, 5.6, 5.45, 5.7],
                        eu: [3.5, 3.7, 3.8, 3.9, 3.85, 4.0, 3.9, 4.1, 4.2, 4.3, 4.15, 4.4],
                        sea: [2.1, 2.3, 2.4, 2.5, 2.45, 2.6, 2.5, 2.7, 2.8, 2.9, 2.75, 3.0],
                        in: [2.8, 3.0, 3.1, 3.2, 3.15, 3.3, 3.2, 3.4, 3.5, 3.6, 3.45, 3.7]
                    }
                }
            };
        }
        
        // ê¸°ë³¸ í•„í„° ì„¤ì •
        function setDefaultFilters() {
            if (rawData.dates.length > 0) {
                const minDate = new Date(Math.min(...rawData.dates));
                const maxDate = new Date(Math.max(...rawData.dates));
                
                document.getElementById('startDate').value = minDate.toISOString().split('T')[0];
                document.getElementById('endDate').value = maxDate.toISOString().split('T')[0];
            }
        }
        
        // í•„í„° ì ìš©
        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            
            const start = startDate ? new Date(startDate) : null;
            const end = endDate ? new Date(endDate) : null;
            const targetMonth = monthFilter ? parseInt(monthFilter) : null;
            const targetYear = yearFilter ? parseInt(yearFilter) : null;
            
            // í•„í„°ëœ ë°ì´í„° ì´ˆê¸°í™”
            filteredData = JSON.parse(JSON.stringify(rawData));
            filteredData.dates = [];
            Object.keys(filteredData.indices).forEach(key => filteredData.indices[key] = []);
            ['shanghai', 'hongkong'].forEach(city => {
                ['sea', 'air'].forEach(mode => {
                    ['us', 'eu', 'sea', 'in'].forEach(dest => {
                        filteredData.freight[city][mode][dest] = [];
                    });
                });
            });
            
            rawData.dates.forEach((date, index) => {
                let include = true;
                
                if (start && date < start) include = false;
                if (end && date > end) include = false;
                if (targetMonth && date.getMonth() + 1 !== targetMonth) include = false;
                if (targetYear && date.getFullYear() !== targetYear) include = false;
                
                if (include) {
                    filteredData.dates.push(date);
                    
                    Object.keys(filteredData.indices).forEach(key => {
                        filteredData.indices[key].push(rawData.indices[key][index]);
                    });
                    
                    ['shanghai', 'hongkong'].forEach(city => {
                        ['sea', 'air'].forEach(mode => {
                            ['us', 'eu', 'sea', 'in'].forEach(dest => {
                                filteredData.freight[city][mode][dest].push(rawData.freight[city][mode][dest][index]);
                            });
                        });
                    });
                }
            });
            
            updateCharts();
        }
        
        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('monthFilter').value = '';
            document.getElementById('yearFilter').value = '';
            
            filteredData = JSON.parse(JSON.stringify(rawData));
            updateCharts();
        }
        
        // ë³€í™”ìœ¨ ê³„ì‚°
        function calculateChange(values) {
            if (values.length < 2) return 0;
            const current = values[values.length - 1];
            const previous = values[Math.max(0, values.length - 4)];
            return previous === 0 ? 0 : ((current - previous) / previous * 100);
        }
        
        // ë©”íŠ¸ë¦­ ì¹´ë“œ ìƒì„±
        function createMetricCards() {
            const metricsGrid = document.getElementById('metricsGrid');
            
            if (!filteredData.dates || filteredData.dates.length === 0) {
                metricsGrid.innerHTML = '<div class="no-data">ğŸ“Š í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            const latest = {
                BDI: filteredData.indices.BDI[filteredData.indices.BDI.length - 1] || 0,
                SCFI: filteredData.indices.SCFI[filteredData.indices.SCFI.length - 1] || 0,
                Harpex: filteredData.indices.Harpex[filteredData.indices.Harpex.length - 1] || 0
            };
            
            const changes = {
                BDI: calculateChange(filteredData.indices.BDI),
                SCFI: calculateChange(filteredData.indices.SCFI),
                Harpex: calculateChange(filteredData.indices.Harpex)
            };
            
            metricsGrid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-title">ë°œí‹±ìš´ì„ì§€ìˆ˜ (BDI)</div>
                    <div class="metric-value">${latest.BDI.toFixed(0)}</div>
                    <span class="metric-change ${changes.BDI >= 0 ? 'positive' : 'negative'}">
                        ${changes.BDI >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(changes.BDI).toFixed(1)}%
                    </span>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ìƒí•´ì»¨í…Œì´ë„ˆìš´ì„ì§€ìˆ˜ (SCFI)</div>
                    <div class="metric-value">${latest.SCFI.toFixed(0)}</div>
                    <span class="metric-change ${changes.SCFI >= 0 ? 'positive' : 'negative'}">
                        ${changes.SCFI >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(changes.SCFI).toFixed(1)}%
                    </span>
                </div>
                <div class="metric-card">
                    <div class="metric-title">í•˜í™ìŠ¤ ì§€ìˆ˜ (Harpex)</div>
                    <div class="metric-value">${latest.Harpex.toFixed(0)}</div>
                    <span class="metric-change ${changes.Harpex >= 0 ? 'positive' : 'negative'}">
                        ${changes.Harpex >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(changes.Harpex).toFixed(1)}%
                    </span>
                </div>
            `;
        }
        
        // ìš´ì„ ìš”ì•½ í…Œì´ë¸” ìƒì„±
        function createFreightSummary() {
            const tbody = document.getElementById('freightSummaryBody');
            
            if (!filteredData.dates || filteredData.dates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9">í•„í„° ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }
            
            const idx = filteredData.dates.length - 1;
            
            tbody.innerHTML = `
                <tr>
                    <td style="font-weight: bold;">ğŸ‡¨ğŸ‡³ ìƒí•´ (Shanghai)</td>
                    <td>$${(filteredData.freight.shanghai.sea.us[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.shanghai.sea.eu[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.shanghai.sea.sea[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.shanghai.sea.in[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.shanghai.air.us[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.shanghai.air.eu[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.shanghai.air.sea[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.shanghai.air.in[idx] || 0).toFixed(1)}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">ğŸ‡­ğŸ‡° í™ì½© (Hong Kong)</td>
                    <td>$${(filteredData.freight.hongkong.sea.us[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.hongkong.sea.eu[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.hongkong.sea.sea[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.hongkong.sea.in[idx] || 0).toFixed(0)}</td>
                    <td>$${(filteredData.freight.hongkong.air.us[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.hongkong.air.eu[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.hongkong.air.sea[idx] || 0).toFixed(1)}</td>
                    <td>$${(filteredData.freight.hongkong.air.in[idx] || 0).toFixed(1)}</td>
                </tr>
            `;
        }
        
        // ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜ë“¤
        function createChart(canvasId, config) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.error(`Canvas ${canvasId} not found`);
                return null;
            }
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
            if (chartInstances[canvasId]) {
                chartInstances[canvasId].destroy();
            }
            
            try {
                chartInstances[canvasId] = new Chart(ctx, config);
                return chartInstances[canvasId];
            } catch (error) {
                console.error(`Chart creation failed for ${canvasId}:`, error);
                return null;
            }
        }
        
        function createIndexTrendChart() {
            if (!filteredData.dates || filteredData.dates.length === 0) return;
            
            const config = {
                type: 'line',
                data: {
                    labels: filteredData.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'BDI',
                            data: filteredData.indices.BDI,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'SCFI',
                            data: filteredData.indices.SCFI,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'Harpex',
                            data: filteredData.indices.Harpex,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'ì§€ìˆ˜ ê°’'
                            }
                        }
                    }
                }
            };
            
            createChart('indexTrendChart', config);
        }
        
        function createSeaFreightChart() {
            if (!filteredData.dates || filteredData.dates.length === 0) return;
            
            const config = {
                type: 'line',
                data: {
                    labels: filteredData.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'ë¶ë¯¸ì„œë¶€',
                            data: filteredData.freight.shanghai.sea.us,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ìœ ëŸ½',
                            data: filteredData.freight.shanghai.sea.eu,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ë™ë‚¨ì•„',
                            data: filteredData.freight.shanghai.sea.sea,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ì¸ë„',
                            data: filteredData.freight.shanghai.sea.in,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'USD/TEU'
                            }
                        }
                    }
                }
            };
            
            createChart('seaFreightChart', config);
        }
        
        function createAirFreightChart() {
            if (!filteredData.dates || filteredData.dates.length === 0) return;
            
            const config = {
                type: 'line',
                data: {
                    labels: filteredData.dates.map(d => `${d.getMonth()+1}/${d.getDate()}`),
                    datasets: [
                        {
                            label: 'ë¶ë¯¸ì„œë¶€',
                            data: filteredData.freight.hongkong.air.us,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ìœ ëŸ½',
                            data: filteredData.freight.hongkong.air.eu,
                            borderColor: '#1abc9c',
                            backgroundColor: 'rgba(26, 188, 156, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ë™ë‚¨ì•„',
                            data: filteredData.freight.hongkong.air.sea,
                            borderColor: '#34495e',
                            backgroundColor: 'rgba(52, 73, 94, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'ì¸ë„',
                            data: filteredData.freight.hongkong.air.in,
                            borderColor: '#e67e22',
                            backgroundColor: 'rgba(230, 126, 34, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'USD/kg'
                            }
                        }
                    }
                }
            };
            
            createChart('airFreightChart', config);
        }
        
        function createWeeklyChangeChart() {
            if (!filteredData.dates || filteredData.dates.length === 0) return;
            
            const changes = [
                { label: 'BDI', value: calculateChange(filteredData.indices.BDI) },
                { label: 'SCFI', value: calculateChange(filteredData.indices.SCFI) },
                { label: 'Harpex', value: calculateChange(filteredData.indices.Harpex) }
            ];
            
            const config = {
                type: 'bar',
                data: {
                    labels: changes.map(c => c.label),
                    datasets: [{
                        label: 'ë³€ë™ë¥  (%)',
                        data: changes.map(c => c.value),
                        backgroundColor: changes.map(c => 
                            c.value >= 0 ? 'rgba(46, 204, 113, 0.6)' : 'rgba(231, 76, 60, 0.6)'
                        ),
                        borderColor: changes.map(c => 
                            c.value >= 0 ? '#2ecc71' : '#e74c3c'
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'ë³€ë™ë¥  (%)'
                            }
                        }
                    }
                }
            };
            
            createChart('weeklyChangeChart', config);
        }
        
        function createRegionComparisonChart() {
            if (!filteredData.dates || filteredData.dates.length === 0) return;
            
            const idx = filteredData.dates.length - 1;
            const latest = {
                us: ((filteredData.freight.shanghai.sea.us[idx] || 0) + (filteredData.freight.hongkong.sea.us[idx] || 0)) / 2,
                eu: ((filteredData.freight.shanghai.sea.eu[idx] || 0) + (filteredData.freight.hongkong.sea.eu[idx] || 0)) / 2,
                sea: ((filteredData.freight.shanghai.sea.sea[idx] || 0) + (filteredData.freight.hongkong.sea.sea[idx] || 0)) / 2,
                in: ((filteredData.freight.shanghai.sea.in[idx] || 0) + (filteredData.freight.hongkong.sea.in[idx] || 0)) / 2
            };
            
            const config = {
                type: 'radar',
                data: {
                    labels: ['ë¶ë¯¸ì„œë¶€', 'ìœ ëŸ½', 'ë™ë‚¨ì•„', 'ì¸ë„'],
                    datasets: [{
                        label: 'í‰ê·  í•´ìƒ ìš´ì„ (USD/TEU)',
                        data: [latest.us, latest.eu, latest.sea, latest.in],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        pointBackgroundColor: '#e74c3c',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            };
            
            createChart('regionComparisonChart', config);
        }
        
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            console.log('ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘');
            
            if (!filteredData.dates) {
                filteredData = JSON.parse(JSON.stringify(rawData));
            }
            
            createMetricCards();
            createFreightSummary();
            createIndexTrendChart();
            createSeaFreightChart();
            createAirFreightChart();
            createWeeklyChangeChart();
            createRegionComparisonChart();
            
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${now.toLocaleString('ko-KR')}`;
            
            console.log('ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        
        // í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadTemplate() {
            console.log('í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì‹œì‘');
            
            const csvContent = `ë‚ ì§œ,BDI,SCFI,Harpex,ìƒí•´-í•´ìƒ-ë¶ë¯¸ì„œë¶€,ìƒí•´-í•´ìƒ-ìœ ëŸ½,ìƒí•´-í•´ìƒ-ë™ë‚¨ì•„,ìƒí•´-í•´ìƒ-ì¸ë„,ìƒí•´-í•­ê³µ-ë¶ë¯¸ì„œë¶€,ìƒí•´-í•­ê³µ-ìœ ëŸ½,ìƒí•´-í•­ê³µ-ë™ë‚¨ì•„,ìƒí•´-í•­ê³µ-ì¸ë„,í™ì½©-í•´ìƒ-ë¶ë¯¸ì„œë¶€,í™ì½©-í•´ìƒ-ìœ ëŸ½,í™ì½©-í•´ìƒ-ë™ë‚¨ì•„,í™ì½©-í•´ìƒ-ì¸ë„,í™ì½©-í•­ê³µ-ë¶ë¯¸ì„œë¶€,í™ì½©-í•­ê³µ-ìœ ëŸ½,í™ì½©-í•­ê³µ-ë™ë‚¨ì•„,í™ì½©-í•­ê³µ-ì¸ë„
2025-01-06,2008,2450,1520,3200,2800,1200,1800,4.8,3.5,2.1,2.8,3300,2900,1300,1900,5.0,3.7,2.3,3.0
2025-01-13,2050,2480,1550,3250,2850,1250,1850,4.9,3.6,2.2,2.9,3350,2950,1350,1950,5.1,3.8,2.4,3.1
2025-01-20,2100,2500,1580,3300,2900,1300,1900,5.0,3.7,2.3,3.0,3400,3000,1400,2000,5.2,3.9,2.5,3.2`;
            
            try {
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { 
                    type: 'text/csv;charset=utf-8;' 
                });
                
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                link.href = url;
                link.download = 'mjl_freight_template.csv';
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
                console.log('í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }
    </script>
</body>
</html>
